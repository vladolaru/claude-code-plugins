# WordPress Internationalization (i18n)

Comprehensive guide to making WordPress plugins and themes translatable.

Based on official WordPress guidelines: https://developer.wordpress.org/apis/internationalization/internationalization-guidelines/

## Writing Quality Translatable Strings

Before diving into functions, understand these **critical guidelines** for writing strings that translate well:

### Language Quality
- Use professional, formal English
- Minimize slang, abbreviations, and colloquialisms
- Be consistent - don't translate similar strings differently throughout your plugin

### Sentence Structure
- **Write complete sentences** - word order varies significantly across languages
- Translators need full context to produce accurate translations
- Split only at paragraph breaks; avoid massive text blocks
- Never split sentences across multiple translation calls

### String Content
- Remove leading and trailing whitespace from strings
- Anticipate that **strings may double in length** when translated (UI implications)
- Avoid unusual markup and control characters
- Use `\n` for newlines; **never use `\r`** (carriage return)
- **Never internationalize empty strings**

### URLs and Special Content
- Don't translate URLs unless localized versions exist
- Don't embed URLs directly in translatable strings
- Keep HTML out of translatable strings when possible

### Placeholders Enable Reordering
Using numbered placeholders (`%1$s`, `%2$s`) allows translators to reorder elements as their language requires - this is essential for proper translation.

## Core Functions

### Basic Translation Functions

#### `__( $text, $domain )`
Returns a translated string. Use when you need the string as a value.

```php
$message = __( 'Payment successful.', 'my-plugin' );
$title = __( 'Settings', 'my-plugin' );
```

#### `_e( $text, $domain )`
Echoes a translated string. Use for direct output in templates.

```php
<h1><?php _e( 'Payment Settings', 'my-plugin' ); ?></h1>
<p><?php _e( 'Configure your payment options below.', 'my-plugin' ); ?></p>
```

### Escaped Translation Functions

**ALWAYS use these when outputting to HTML**:

#### `esc_html__( $text, $domain )`
Returns translated and HTML-escaped string.

```php
$title = esc_html__( 'Order Details', 'my-plugin' );
echo '<h2>' . esc_html__( 'Payment History', 'my-plugin' ) . '</h2>';
```

#### `esc_html_e( $text, $domain )`
Echoes translated and HTML-escaped string.

```php
<label><?php esc_html_e( 'Card Number', 'my-plugin' ); ?></label>
```

#### `esc_attr__( $text, $domain )`
Returns translated and attribute-escaped string.

```php
<input type="text" placeholder="<?php echo esc_attr__( 'Enter amount', 'my-plugin' ); ?>">
```

#### `esc_attr_e( $text, $domain )`
Echoes translated and attribute-escaped string.

```php
<input type="submit" value="<?php esc_attr_e( 'Submit Payment', 'my-plugin' ); ?>">
```

### Placeholders with sprintf

#### `sprintf()` with `__()`
For strings with variables. **Note:** Translator comment goes immediately before the translation function, inside sprintf:

```php
$message = sprintf(
	/* translators: %s: Customer name */
	__( 'Hello %s, your payment was successful.', 'my-plugin' ),
	$customer_name
);

$message = sprintf(
	/* translators: 1: Order number, 2: Order date */
	__( 'Order #%1$s placed on %2$s.', 'my-plugin' ),
	$order_number,
	$order_date
);
```

#### `printf()` with `__()`
For direct output with variables:

```php
printf(
	/* translators: %s: Amount */
	esc_html__( 'Total: %s', 'my-plugin' ),
	wc_price( $amount )
);
```

### Plural Forms

#### `_n( $single, $plural, $number, $domain )`
Handles singular/plural forms. For `_n()`, the translator comment goes immediately before the function:

```php
$message = sprintf(
	/* translators: %d: Number of items */
	_n(
		'%d item',
		'%d items',
		$count,
		'my-plugin'
	),
	$count
);

printf(
	/* translators: %d: Number of payments */
	esc_html( _n(
		'%d payment processed',
		'%d payments processed',
		$total,
		'my-plugin'
	) ),
	$total
);
```

#### `_nx( $single, $plural, $number, $context, $domain )`
Plural with context:

```php
$message = sprintf(
	/* translators: %d: Number of transactions */
	_nx(
		'%d transaction',
		'%d transactions',
		$count,
		'dashboard widget',
		'my-plugin'
	),
	$count
);
```

### Context-Specific Translations

#### `_x( $text, $context, $domain )`
When a word has multiple meanings:

```php
// "Post" as a noun (blog post)
$label = _x( 'Post', 'noun', 'my-plugin' );

// "Post" as a verb (to post/submit)
$action = _x( 'Post', 'verb', 'my-plugin' );

// Credit card type context
$card = _x( 'Visa', 'credit card brand', 'my-plugin' );
```

#### `_ex( $text, $context, $domain )`
Echo version of `_x()`:

```php
<button><?php _ex( 'Post', 'verb', 'my-plugin' ); ?></button>
```

#### `esc_html_x()` and `esc_attr_x()`
Escaped versions with context:

```php
echo esc_html_x( 'Order', 'noun', 'my-plugin' );
```

### No-Operation Functions

#### `_n_noop( $singular, $plural, $domain )`
Register plural strings for later translation:

```php
$messages = [
	'item' => _n_noop(
		'%d item',
		'%d items',
		'my-plugin'
	),
];

// Later use with translate_nooped_plural()
$message = sprintf(
	translate_nooped_plural( $messages['item'], $count, 'my-plugin' ),
	$count
);
```

## Translator Comments

**REQUIRED for all strings with placeholders**.

### CRITICAL: Comment Placement Rule

The translator comment **MUST appear IMMEDIATELY before the translation function** (`__()`, `_e()`, `esc_html__()`, `_n()`, etc.). Nothing can be between the comment and the function.

```
✅ /* translators: ... */ __()     ← Comment immediately before __()
❌ /* translators: ... */ sprintf( __() )  ← sprintf() is between comment and __()
```

### Visual Examples

**✅ CORRECT** - Single-line (comment immediately before `__()`):
```php
/* translators: %s: Customer name */
$message = sprintf( __( 'Hello %s!', 'my-plugin' ), $name );
```

**✅ CORRECT** - Multi-line (comment INSIDE sprintf, immediately before `__()`):
```php
$message = sprintf(
	/* translators: %s: Customer email address */
	__( 'Confirmation sent to %s.', 'my-plugin' ),
	$email
);
```

**❌ WRONG** - Comment OUTSIDE sprintf (`sprintf()` is between comment and `__()`):
```php
/* translators: %s: Customer email address */
$message = sprintf(
	__( 'Confirmation sent to %s.', 'my-plugin' ),
	$email
);
```

**Why this matters**: The translation extraction tool (`wp i18n make-pot`) only finds comments that immediately precede the translation function. Misplaced comments are silently ignored, leaving translators without context.

### Multi-Line Format
For longer explanations:
```php
/*
 * translators: Replace with a city related to your locale.
 * This is used in the store locator feature to show a default city.
 */
esc_attr_e( 'Cincinnati', 'my-plugin' );
```

### Multiple Placeholders
```php
$message = sprintf(
	/* translators: 1: Payment method, 2: Amount, 3: Currency */
	__( 'Charged %2$s %3$s via %1$s.', 'my-plugin' ),
	$method,
	$amount,
	$currency
);
```

### HTML with Opening/Closing Tags
```php
sprintf(
	/* translators: 1: Opening tag(s) for the anchor, 2: number of business days, 3: Closing tag(s) for the anchor. */
	esc_html__( 'Funds will be available after a %1$s%2$s business days pending period%3$s.', 'my-plugin' ),
	'<strong><a href="https://example.com/docs">',
	esc_html( $delay_days ),
	'</a></strong>'
);
```

### Link as Single Placeholder
```php
$message = sprintf(
	/* translators: %s: Link to documentation */
	__( 'Learn more in our %s.', 'my-plugin' ),
	'<a href="' . esc_url( $docs_url ) . '">' . esc_html__( 'documentation', 'my-plugin' ) . '</a>'
);
```

### Complex Placeholders
```php
$message = sprintf(
	/* translators: 1: Opening strong tag, 2: Closing strong tag, 3: Error message */
	__( '%1$sError:%2$s %3$s', 'my-plugin' ),
	'<strong>',
	'</strong>',
	esc_html( $error )
);
```

## Text Domain

### Rules
1. Text domain must match plugin slug (folder name)
2. Use consistently throughout the plugin
3. Never use variables for text domain

```php
// Good
__( 'Text', 'my-plugin' );

// Bad - variable text domain
__( 'Text', $text_domain );
__( 'Text', MYPLUGIN_TEXT_DOMAIN );
```

### Plugin Header
```php
/**
 * Plugin Name: WooCommerce Payments
 * Text Domain: my-plugin
 * Domain Path: /languages
 */
```

### Loading Text Domain
```php
add_action( 'init', 'myplugin_load_textdomain' );

function myplugin_load_textdomain() {
	load_plugin_textdomain(
		'my-plugin',
		false,
		dirname( plugin_basename( __FILE__ ) ) . '/languages'
	);
}
```

## Common Mistakes

### Embedded Variables in Strings

**WRONG** - Variables inside double-quoted strings:
```php
// Variables can't be extracted for translation
_e( "Your city is $city.", 'my-plugin' );
```

**CORRECT** - Use printf/sprintf with placeholders:
```php
printf(
	/* translators: %s: City name */
	__( 'Your city is %s.', 'my-plugin' ),
	$city
);
```

### String Concatenation

**WRONG** - Breaks translation:
```php
// Translators can't reorder words
$message = __( 'Hello ', 'my-plugin' ) . $name . __( '!', 'my-plugin' );
```

**CORRECT** - Use placeholders:
```php
$message = sprintf(
	/* translators: %s: Customer name */
	__( 'Hello %s!', 'my-plugin' ),
	$name
);
```

### HTML in Strings

**WRONG** - HTML breaks translations and poses security risks:
```php
$message = __( '<strong>Warning:</strong> Payment failed.', 'my-plugin' );
```

**CORRECT** - Separate HTML from translatable content:
```php
$message = sprintf(
	/* translators: 1: Opening strong tag, 2: Closing strong tag */
	__( '%1$sWarning:%2$s Payment failed.', 'my-plugin' ),
	'<strong>',
	'</strong>'
);

// Or use wp_kses for safe HTML
$message = wp_kses(
	__( '<strong>Warning:</strong> Payment failed.', 'my-plugin' ),
	[ 'strong' => [] ]
);
```

### URLs in Strings

**WRONG**:
```php
$message = __( 'Visit https://example.com for help.', 'my-plugin' );
```

**CORRECT**:
```php
$message = sprintf(
	/* translators: %s: Link text */
	__( 'Visit %s for help.', 'my-plugin' ),
	'<a href="https://example.com">' . esc_html__( 'our help center', 'my-plugin' ) . '</a>'
);
```

### Variable Text

**WRONG** - Variables can't be translated:
```php
$status = 'active';
$message = __( $status, 'my-plugin' );
```

**CORRECT** - Use a mapping:
```php
$status_labels = [
	'active'   => __( 'Active', 'my-plugin' ),
	'pending'  => __( 'Pending', 'my-plugin' ),
	'inactive' => __( 'Inactive', 'my-plugin' ),
];

$message = isset( $status_labels[ $status ] ) ? $status_labels[ $status ] : $status;
```

### Missing Escape

**WRONG** - Unescaped output:
```php
echo __( 'Hello', 'my-plugin' );
_e( 'Hello', 'my-plugin' );  // Only okay if you trust all translators
```

**CORRECT** - Always escape:
```php
echo esc_html__( 'Hello', 'my-plugin' );
esc_html_e( 'Hello', 'my-plugin' );
```

### Date/Time Formatting

**WRONG** - Hardcoded format:
```php
$date = date( 'F j, Y', $timestamp );
$message = sprintf(
	__( 'Created on %s', 'my-plugin' ),
	$date
);
```

**CORRECT** - Use localized format:
```php
$date = date_i18n( get_option( 'date_format' ), $timestamp );
$message = sprintf(
	/* translators: %s: Date */
	__( 'Created on %s', 'my-plugin' ),
	$date
);
```

### Numbers

**CORRECT** - Use `number_format_i18n()`:
```php
$message = sprintf(
	/* translators: %s: Number of orders */
	__( '%s orders processed', 'my-plugin' ),
	number_format_i18n( $count )
);
```

## JavaScript Localization

### wp_localize_script()

```php
wp_enqueue_script( 'wcpay-admin', MYPLUGIN_PLUGIN_URL . 'assets/js/admin.js', [], MYPLUGIN_VERSION, true );

wp_localize_script(
	'wcpay-admin',
	'wcpayAdmin',
	[
		'ajaxUrl'  => admin_url( 'admin-ajax.php' ),
		'nonce'    => wp_create_nonce( 'myplugin_admin' ),
		'i18n'     => [
			'confirmDelete' => __( 'Are you sure you want to delete?', 'my-plugin' ),
			'processing'    => __( 'Processing...', 'my-plugin' ),
			'success'       => __( 'Success!', 'my-plugin' ),
			'error'         => __( 'An error occurred.', 'my-plugin' ),
		],
	]
);
```

### wp_set_script_translations() (WordPress 5.0+)

```php
wp_enqueue_script( 'wcpay-blocks', MYPLUGIN_PLUGIN_URL . 'build/blocks.js', [], MYPLUGIN_VERSION, true );
wp_set_script_translations( 'wcpay-blocks', 'my-plugin', MYPLUGIN_PLUGIN_PATH . 'languages' );
```

In JavaScript:
```javascript
import { __ } from '@wordpress/i18n';

const message = __( 'Hello World', 'my-plugin' );
```

## Generating POT Files

### WP-CLI
```bash
wp i18n make-pot . languages/my-plugin.pot --slug=my-plugin
```

### npm script (with @wordpress/scripts)
```json
{
	"scripts": {
		"i18n:pot": "wp i18n make-pot . languages/my-plugin.pot"
	}
}
```

## RTL Support

For right-to-left languages:

```php
// Check RTL
if ( is_rtl() ) {
	wp_enqueue_style( 'wcpay-rtl', MYPLUGIN_PLUGIN_URL . 'assets/css/admin-rtl.css' );
}

// Or use automatic RTL stylesheet
wp_enqueue_style( 'wcpay-admin', MYPLUGIN_PLUGIN_URL . 'assets/css/admin.css' );
wp_style_add_data( 'wcpay-admin', 'rtl', 'replace' ); // Loads admin-rtl.css automatically
```

## Testing Translations

### Check String Extraction
```bash
# Generate POT and review
wp i18n make-pot . languages/test.pot --slug=my-plugin
cat languages/test.pot | grep -A2 "msgid"
```

### Test with Debug Plugin
Use "Loco Translate" or "Debug Translations" plugin to verify strings are translatable.

### Pseudo-Localization
Replace strings with accented characters to spot untranslatable strings:
- "Hello" becomes "Ħḗŀŀǿ"
- Helps identify hardcoded strings